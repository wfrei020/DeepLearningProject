% Deep Learning Project
%Author: Walter Freire
%Course: EE8608
%based on the paper Scene Recognition by Manifold regularized deep learning architecture

%lets test sift

function Y=SceneRecognition();
%img_path = '../../../src/datasets/15CategoryDataSet/trainingSet/00/1.jpg'
img_path = '../../../src/datasets/15CategoryDataSet/completeSet/15-Scene/00/1.jpg';
feature = SIFT_feature(img_path);
dataT = feature;
img_path = '../../../src/datasets/15CategoryDataSet/completeSet/15-Scene/00/2.jpg';
feature = SIFT_feature(img_path);
dataT = [dataT feature];

img_path = '../../../src/datasets/15CategoryDataSet/completeSet/15-Scene/00/3.jpg';
feature = SIFT_feature(img_path);
dataT = [dataT feature];
img_path = '../../../src/datasets/15CategoryDataSet/completeSet/15-Scene/00/4.jpg';
feature = SIFT_feature(img_path);
dataT = [dataT feature];
if(0)
img_path = '../../../src/datasets/15CategoryDataSet/completeSet/15-Scene/01/217.jpg';
feature = SIFT_feature(img_path);
dataT = [dataT feature];
img_path = '../../../src/datasets/15CategoryDataSet/completeSet/15-Scene/01/218.jpg';
feature = SIFT_feature(img_path);
dataT = [dataT feature];
img_path = '../../../src/datasets/15CategoryDataSet/completeSet/15-Scene/01/219.jpg';
feature = SIFT_feature(img_path);
dataT = [dataT feature];

img_path = '../../../src/datasets/15CategoryDataSet/completeSet/15-Scene/01/220.jpg';
feature = SIFT_feature(img_path);
dataT = [dataT feature];
img_path = '../../../src/datasets/15CategoryDataSet/completeSet/15-Scene/02/458.jpg';
feature = SIFT_feature(img_path);
dataT = [dataT feature];
img_path = '../../../src/datasets/15CategoryDataSet/completeSet/15-Scene/02/459.jpg';
feature = SIFT_feature(img_path);
dataT = [dataT feature];
img_path = '../../../src/datasets/15CategoryDataSet/completeSet/15-Scene/02/460.jpg';
feature = SIFT_feature(img_path);
dataT = [dataT feature];
img_path = '../../../src/datasets/15CategoryDataSet/completeSet/15-Scene/02/461.jpg';
feature = SIFT_feature(img_path);
dataT = [dataT feature];
img_path = '../../../src/datasets/15CategoryDataSet/completeSet/15-Scene/03/769.jpg';
feature = SIFT_feature(img_path);
dataT = [dataT feature];
img_path = '../../../src/datasets/15CategoryDataSet/completeSet/15-Scene/03/770.jpg';
feature = SIFT_feature(img_path);
dataT = [dataT feature];
img_path = '../../../src/datasets/15CategoryDataSet/completeSet/15-Scene/03/771.jpg';
feature = SIFT_feature(img_path);
dataT = [dataT feature];
img_path = '../../../src/datasets/15CategoryDataSet/completeSet/15-Scene/03/772.jpg';
feature = SIFT_feature(img_path);
dataT = [dataT feature];
end
data = dataT';
layers = 1;
if(0)
x = 1:size(data,1);
for i=1:size(data,1)
    y(i) = norm(data(i,:),1);
end
figure(1)
scatter(x,y)
end
W = ones(size(data,1));
for L = 1:layers

disp('on a LOOP start')
size(data)



options=make_options;
%options.NN=NN;
options.Kernel='rbf';
%options.KernelParam=SIGMA;
%options.gamma_A=gamma_A; 
%options.gamma_I=gamma_I; 
options.GraphWeights='heat';
%options.GraphWeightParam=SIGMA;
%options.LaplacianDegree=DEGREE;
options.PointCloud = data;
dataT(1)
dataT(2)
dataT(3)
dataT(4)

M = lle(dataT,5,128);
%already done
%I=eye(size(M')); 
%M = (I-M')*(I-M')';
%what i thought it was
% I=eye(size(M')); 
% M = (I-M')*(I-M')';
options.DeformationMatrix = M;

K=calckernel(options,data);
%I believe up until this part it is correct
%need to loop this eventually properly

W = (K./(K.*W +0.1*W+(0.1/4)*(W.^(1/2)))).*W;
D = eye(size(W)).*((1/2)*(W+W'));
WT = 1/2*(W+W')*(D^(-1));
WT
%WT
%D^(-1)

size(WT)

%G = WT;
%WT
return
G = compute_relation(data');
%G = compute_relation(dataT);
nbCluster = 4;
[NcutDiscrete,NcutEigenvectors,NcutEigenvalues] = ncutW(G,nbCluster);

size(NcutEigenvectors)
disp(['The computation took ' num2str(toc) ' seconds']);

 Y = NcutEigenvectors'*inv(D^(1/2));
size(Y)
figure(L+6)
plot(NcutEigenvectors)

YT = Y';
x = 1:size(YT,1);
for i=1:size(YT,1)
    y(i) = norm(YT(i,:),1);
end
figure(L+1)
scatter(x,y)

data = Y';
end
 % figure(1);
%plot(Y);
return
% display clustering result
cluster_color = ['rgbmyc'];
figure(2);clf;
for j=1:nbCluster,
    id = find(NcutDiscrete(:,j));
    plot(data(1,id),data(2,id),[cluster_color(j),'s'], 'MarkerFaceColor',cluster_color(j),'MarkerSize',5); hold on; 
end
hold off; axis image;
disp('This is the clustering result');
disp('The demo is finished.');

% the deformed kernel matrix evaluated over test data
